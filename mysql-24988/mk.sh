#!/bin/bash

set -e

# Unzip the source file to current folder
if [[ ! -d mysql-5.0.27 ]]; then
    if [[ ! -f ../apps/mysql-5.0.27.tar.gz ]]; then
        wget http://downloads.mysql.com/archives/get/file/mysql-5.0.27.tar.gz -P ../apps/
	else
        echo "Using existing mysql-5.0.27.tar.gz source file"
	fi

    tar xzf ../apps/mysql-5.0.27.tar.gz
else
    echo "Using existing mysql-5.0.27 source code"
fi

pushd mysql-5.0.27

CFLAGS="-g -O0" CXXFLAGS="-g -O0" CC="clang" CXX="clang++" ./configure --prefix=`pwd`/../mysql-install-clang --with-debug

patch  < ../after_configuration.patch

make -j16
make install

popd

echo "Done building mysql!"
