#!/bin/bash

# The following script will download and build mysql-5.0.27

wget http://downloads.mysql.com/archives/get/file/mysql-5.0.27.tar.gz
# Unzip the source file to current folder
if [ -f mysql-5.0.27.tar.gz ]
then
    if [ ! -d mysql-5.0.27 ]
    then
        tar xzf mysql-5.0.27.tar.gz
    else
        echo "Use existing mysql-5.0.27 source code."
    fi
else
    echo "Missing mysql-5.0.27 source file, please check the wget link."
fi

pushd mysql-5.0.27

# MySQL-5.0.27 requires gcc-3.4.
gcc-3.4 --version
if [ $? -ne 0 ]
then
    echo "Please install gcc-3.4"
    exit 1
fi

CFLAGS="-O0 -g" CXXFLAGS="-O0 -g" CC="clang" CXX="clang++" ./configure --prefix=`pwd`/../mysql-install-clang --with-debug

make -j16
make install

popd

echo "Done building mysql!"
