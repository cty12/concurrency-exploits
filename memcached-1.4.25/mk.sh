#!/bin/bash

# The following script will build openssh-4.3p1

# Step 1: Compile openssh
# Unzip the source file to current folder
if [ -f ../apps/memcached-1.4.25.tar.gz ]
then
    if [ ! -d memcached-1.4.25 ]
    then
        tar xf ../apps/memcached-1.4.25.tar.gz
    else
        echo "Use existing memcached-1.4.21 source code."
    fi
else
    echo "Missing memcached-1.4.21 source file. Check Apps folder."
fi

# configure memcached
cd memcached-1.4.25

# Add the -g flag
CFLAGS="-g -O0 -fsanitize=thread" CXXFLAGS="-g -O0 -fsanitize=thread" CC="clang" CXX="clang++" ./configure --prefix=`pwd`/../memcached-install-tsan

make -j16
make install


