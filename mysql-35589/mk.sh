#!/bin/bash

# Unzip the source file to current folder
if [[ ! -d mysql-5.1.35 ]]; then
    if [[ ! -f ../apps/mysql-5.1.35.tar.gz ]]; then
        wget http://downloads.mysql.com/archives/get/file/mysql-5.1.35.tar.gz -P ../apps/
	else
        echo "Using existing mysql-5.1.35.tar.gz source file"
	fi

    tar xzf ../apps/mysql-5.1.35.tar.gz
else
    echo "Using existing mysql-5.1.35 source code"
fi

pushd mysql-5.1.35

export LIBRARY_PATH=/usr/lib/x86_64-linux-gnu/
CFLAGS="-g -O0 -fsanitize=thread" CXXFLAGS="-g -O0 -fsanitize=thread" CC="clang" CXX="clang++" ./configure --prefix=`pwd`/../mysql-install-clang --with-debug

make -j16
make install

popd

echo "Done building mysql!"
