--- a/build.sh
+++ b/build.sh
@@ -11,10 +11,10 @@ if test -z "$MAKE"; then
 	MAKE=make
 fi
 if test -z "$CC"; then
-	CC=gcc
+	CC=clang
 fi
 if test -z "$CXX"; then
-	CXX=g++
+	CXX=clang++
 fi
 
 case "$TARGET_OS" in
@@ -121,10 +121,16 @@ echo "JEMALLOC_PATH=$JEMALLOC_PATH" >> build_config.mk
 echo "SNAPPY_PATH=$SNAPPY_PATH" >> build_config.mk
 
 echo "CFLAGS = $CFLAGS" >> build_config.mk
-echo "CFLAGS += -DNDEBUG -D__STDC_FORMAT_MACROS -Wall -O2 -Wno-sign-compare" >> build_config.mk
+echo "CFLAGS += -fsanitize=thread -D__STDC_FORMAT_MACROS -Wall -O0 -Wno-sign-compare" >> build_config.mk
 echo "CFLAGS += ${PLATFORM_CFLAGS}" >> build_config.mk
 echo "CFLAGS += -I \"$LEVELDB_PATH/include\"" >> build_config.mk
 
+echo "CXXFLAGS = $CFLAGS" >> build_config.mk
+echo "CXXFLAGS += -fsanitize=thread -O0 " >> build_config.mk
+
+echo "LDFLAGS = $LDLAGS" >> build_config.mk
+echo "LDFLAGS += -fsanitize=thread" >> build_config.mk
+
 echo "CLIBS=" >> build_config.mk
 echo "CLIBS += ${PLATFORM_CLIBS}" >> build_config.mk
 echo "CLIBS += \"$LEVELDB_PATH/libleveldb.a\"" >> build_config.mk
--- a/deps/leveldb-1.18/Makefile
+++ b/deps/leveldb-1.18/Makefile
@@ -7,7 +7,7 @@
 # to switch between compilation modes.
 
 # (A) Production use (optimized mode)
-OPT ?= -O2 -DNDEBUG
+OPT ?= -O0
 # (B) Debug mode, w/ full line-level debugging symbols
 # OPT ?= -g2
 # (C) Profiling mode: opt, but w/debugging symbols
@@ -15,13 +15,15 @@ OPT ?= -O2 -DNDEBUG
 #-----------------------------------------------
 
 # detect what platform we're building on
-$(shell CC="$(CC)" CXX="$(CXX)" TARGET_OS="$(TARGET_OS)" \
+$(shell CC="clang" CXX="clang++" TARGET_OS="$(TARGET_OS)" \
     ./build_detect_platform build_config.mk ./)
 # this file is generated by the previous line to set build flags and sources
 include build_config.mk
 
 CFLAGS += -I. -I./include $(PLATFORM_CCFLAGS) $(OPT)
+CFLAGS += -fsanitize=thread
 CXXFLAGS += -I. -I./include $(PLATFORM_CXXFLAGS) $(OPT)
+CXXFLAGS += -fsanitize=thread
 
 LDFLAGS += $(PLATFORM_LDFLAGS)
 LIBS += $(PLATFORM_LIBS)
--- a/deps/leveldb-1.18/build_detect_platform
+++ b/deps/leveldb-1.18/build_detect_platform
@@ -37,11 +37,11 @@ rm -f $OUTPUT
 touch $OUTPUT
 
 if test -z "$CC"; then
-    CC=cc
+    CC=clang
 fi
 
 if test -z "$CXX"; then
-    CXX=g++
+    CXX=clang++
 fi
 
 if test -z "$TMPDIR"; then
@@ -55,8 +55,8 @@ fi
 
 COMMON_FLAGS=
 CROSS_COMPILE=
-PLATFORM_CCFLAGS=
-PLATFORM_CXXFLAGS=
+PLATFORM_CCFLAGS="-fsanitize=thread"
+PLATFORM_CXXFLAGS="-fsanitize=thread"
 PLATFORM_LDFLAGS=
 PLATFORM_LIBS=
 PLATFORM_SHARED_EXT="so"
