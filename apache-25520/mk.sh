#!/bin/bash

# The following script will build apache 2.0.46 & php-4.4.1

# Step 1: Compile Apache
# Unzip the source file to current folder
if [ -f ../apps/httpd-2.0.48.tar.gz ]
then
    if [ ! -d httpd-2.0.48 ]
    then
        tar xzf ../apps/httpd-2.0.48.tar.gz
    else
        echo "Use existing httpd-2.0.48 source code."
    fi
else
    echo "Missing apache 2.0.48 source file. Check Apps folder."
fi

# configure apache
cd httpd-2.0.48
./configure --prefix=`pwd`/../apache-install --with-mpm=worker --disable-cgid CFLAGS="-g"

# Apply patch to let apache compile
cp ../compile.patch .
patch -p0 < compile.patch

if [ $? -ne 0 ]
then
    echo "Couldn't apply compile.patch" 
    exit 1
fi

make
make install

cd ..
patch -p0 < httpdconf.patch
if [ $? -ne 0 ]
then
    echo "Couldn't apply httpdconfig.patch" 
    exit 1
fi

echo "Apache compile & configuration done!"


